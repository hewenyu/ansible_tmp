---
# base_task/zabbix.yml
- name: Create a new host or update an existing host's info
  local_action:
    module: zabbix_host
    # 基本信息
    server_url: http://"{{ master_ip }}"
    login_user: "{{ login_user }}"
    login_password: "{{ login_password }}"
    
    host_name: "{{ hostname }}"
    visible_name: "{{ hostname }}"
    description: "{{ hostname }}"
    
    host_groups:
      - Linux server
    #  - Example group2
    link_templates:
      - Template OS Linux
    #  - Example template2

    status: enabled
    state: present
    #inventory_mode: manual
    #inventory_zabbix:
    #  tag: "{{ your_tag }}"
    #  alias: "{{ your_alias }}"
    #  notes: "Special Informations: {{ your_informations | default('None') }}"
    #  location: "{{ your_location }}"
    #  site_rack: "{{ your_site_rack }}"
    #  os: "{{ your_os }}"
    #  hardware: "{{ your_hardware }}"
    #ipmi_authtype: 2
    #ipmi_privilege: 4
    #ipmi_username: username
    #ipmi_password: password
    interfaces:
      - type: 1
        main: 1
        useip: 1
        ip: "{{ host_ip["stdout"] }}"
        dns: ""
        port: 10050
    #proxy: a.zabbix.proxy

#- name: Update an existing host's TLS settings
#  local_action:
#    module: zabbix_host
#    server_url: http://monitor.example.com
#    login_user: username
#    login_password: password
#    host_name: ExampleHost
#    visible_name: ExampleName
#    host_groups:
#      - Example group1
#    tls_psk_identity: test
#    tls_connect: 2
#    tls_psk: 123456789abcdef123456789abcdef12